# 数据库连接问题解决方案

## 问题诊断

根据测试结果，您遇到的是**数据库访问被拒绝**的错误：
```
Access denied for user 'root'@'localhost' (using password: YES)
```

## 可能的原因

1. **MySQL密码不正确** - 配置的密码与实际密码不匹配
2. **MySQL服务未启动** - MySQL服务可能没有运行
3. **数据库不存在** - 'project' 数据库可能还未创建
4. **用户权限问题** - root用户可能没有访问权限

## 解决步骤

### 步骤 1: 确认MySQL服务正在运行

**Windows PowerShell:**
```powershell
# 检查MySQL服务状态
Get-Service -Name MySQL* | Select-Object Name, Status

# 如果服务未运行，启动它
net start MySQL
# 或者
net start MySQL80
# 具体服务名可能因安装而异
```

### 步骤 2: 测试数据库连接

使用MySQL命令行客户端测试连接：

```bash
mysql -u root -p
```

输入您的MySQL root密码。如果能成功连接，说明密码是正确的。

### 步骤 3: 确认数据库是否存在

在MySQL命令行中执行：

```sql
SHOW DATABASES;
```

检查是否有名为 `project` 的数据库。如果没有，创建它：

```sql
CREATE DATABASE project CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 步骤 4: 配置正确的数据库密码

您有两种方式配置数据库连接：

#### 方式一：使用环境变量（推荐）

在PowerShell中设置环境变量：

```powershell
$env:DB_HOST="localhost"
$env:DB_USER="root"
$env:DB_PASSWORD="你的实际MySQL密码"
$env:DB_NAME="project"
```

#### 方式二：直接修改 app.py

在 `app.py` 的第 221-226 行，修改 `db_config` 字典中的密码：

```python
db_config = {
    'host': os.getenv('DB_HOST', 'localhost'),
    'user': os.getenv('DB_USER', 'root'),
    'password': os.getenv('DB_PASSWORD', '你的实际MySQL密码'),  # 修改这里
    'database': os.getenv('DB_NAME', 'project')
}
```

### 步骤 5: 验证连接

运行测试脚本验证连接：

```powershell
python test_db_connection.py
```

如果连接成功，您应该看到：
- ✓ 成功连接到数据库！
- ✓ 当前数据库: project
- ✓ 找到 X 个表

## 常见问题

### Q: 忘记MySQL root密码怎么办？

**重置MySQL root密码（Windows）:**

1. 停止MySQL服务：
   ```powershell
   net stop MySQL
   ```

2. 创建临时文件 `C:\mysql-init.txt`，内容：
   ```
   ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码';
   ```

3. 以跳过权限表的方式启动MySQL：
   ```powershell
   mysqld --init-file=C:\mysql-init.txt --console
   ```

4. MySQL启动后，按Ctrl+C停止，然后正常启动MySQL服务：
   ```powershell
   net start MySQL
   ```

5. 删除临时文件 `C:\mysql-init.txt`

### Q: 如何查看当前MySQL root密码？

MySQL密码是加密存储的，无法直接查看。如果您忘记了密码，需要重置（见上方）。

### Q: 数据库连接测试脚本在哪里？

我已经为您创建了 `test_db_connection.py` 脚本，您可以随时运行它来测试数据库连接。

## 下一步

1. 确认MySQL服务正在运行
2. 验证root用户密码
3. 确保 `project` 数据库存在
4. 更新 `app.py` 中的密码或设置环境变量
5. 运行 `test_db_connection.py` 验证连接
6. 如果测试成功，运行 `python app.py` 启动应用

