{% extends 'base.html' %}


{% block title %}æ•°æ®å¯¼å…¥ - ç®¡ç†å‘˜åå°{% endblock %}

{% block content %}
<style>
    .admin-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 0 20px;
    }
    
    .back-link {
        color: var(--color-primary);
        text-decoration: none;
        margin-bottom: 20px;
        display: inline-block;
    }
    
    .back-link:hover {
        text-decoration: underline;
    }
    
    .import-panel {
        background-color: var(--color-white);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 40px;
    }
    
    .import-header {
        text-align: center;
        margin-bottom: 40px;
    }
    
    .import-title {
        font-size: 2rem;
        font-weight: bold;
        color: var(--color-text);
        margin-bottom: 10px;
    }
    
    .import-subtitle {
        color: #666;
        font-size: 0.95rem;
    }
    
    .upload-area {
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        padding: 60px 40px;
        text-align: center;
        margin-bottom: 30px;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .upload-area:hover {
        border-color: var(--color-primary);
        background-color: #fafafa;
    }
    
    .upload-area.dragover {
        border-color: var(--color-accent);
        background-color: #fff9e6;
    }
    
    .upload-icon {
        font-size: 4rem;
        color: var(--color-primary);
        margin-bottom: 20px;
    }
    
    .upload-text {
        font-size: 1.1rem;
        color: var(--color-text);
        margin-bottom: 10px;
    }
    
    .upload-hint {
        font-size: 0.9rem;
        color: #999;
    }
    
    .file-input {
        display: none;
    }
    
    .selected-file {
        display: none;
        padding: 15px;
        background-color: #e8f5e9;
        border: 1px solid #4caf50;
        border-radius: 4px;
        margin-bottom: 20px;
    }
    
    .selected-file.show {
        display: block;
    }
    
    .selected-file-name {
        font-weight: bold;
        color: #2e7d32;
    }
    
    .import-options {
        margin-bottom: 30px;
    }
    
    .option-group {
        margin-bottom: 20px;
    }
    
    .option-label {
        display: block;
        font-weight: bold;
        color: var(--color-text);
        margin-bottom: 10px;
    }
    
    .radio-group {
        display: flex;
        gap: 30px;
    }
    
    .radio-option {
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    
    .radio-option input {
        margin-right: 8px;
    }
    
    .submit-btn {
        width: 100%;
        padding: 15px;
        background-color: var(--color-text);
        color: var(--color-white);
        border: none;
        border-radius: 4px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .submit-btn:hover:not(:disabled) {
        background-color: var(--color-accent);
    }
    
    .submit-btn:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }
    
    .template-section {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .template-title {
        font-weight: bold;
        color: var(--color-text);
        margin-bottom: 10px;
    }
    
    .template-description {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 15px;
    }
    
    .download-template-btn {
        padding: 10px 20px;
        background-color: var(--color-primary);
        color: var(--color-white);
        text-decoration: none;
        border-radius: 4px;
        font-weight: bold;
        display: inline-block;
        transition: all 0.2s;
    }
    
    .download-template-btn:hover {
        background-color: var(--color-accent);
    }
    
    .info-box {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 4px;
    }
    
    .info-box-title {
        font-weight: bold;
        color: #1976d2;
        margin-bottom: 8px;
    }
    
    .info-box-list {
        font-size: 0.9rem;
        color: #555;
        line-height: 1.8;
        margin-left: 20px;
    }
</style>

<div class="admin-container">
    <a href="{{ url_for('admin_dashboard') }}" class="back-link">â† è¿”å›ä»ªè¡¨æ¿</a>
    
    <div class="import-panel">
        <div class="import-header">
            <h1 class="import-title">ğŸ“¥ å…ƒæ•°æ®å¯¼å…¥</h1>
            <p class="import-subtitle">æ‰¹é‡å¯¼å…¥æ–‡ç‰©å…ƒæ•°æ®ä¿¡æ¯</p>
        </div>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="margin-bottom: 20px;">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}" style="padding: 12px; border-radius: 4px; margin-bottom: 10px;">
                            {{ message }}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <!-- ä¸‹è½½æ¨¡æ¿ -->
        <div class="template-section">
            <div class="template-title">ğŸ“„ ä¸‹è½½å¯¼å…¥æ¨¡æ¿</div>
            <div class="template-description">
                é¦–æ¬¡ä½¿ç”¨ï¼Ÿä¸‹è½½æ ‡å‡†æ¨¡æ¿ï¼Œå¡«å†™æ•°æ®åä¸Šä¼ 
            </div>
            <a href="{{ url_for('download_import_template') }}" class="download-template-btn">
                ä¸‹è½½ CSV æ¨¡æ¿
            </a>
        </div>
        
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="info-box">
            <div class="info-box-title">ğŸ“Œ å¯¼å…¥è¯´æ˜</div>
            <ul class="info-box-list">
                <li>æ”¯æŒ CSV å’Œ Excel æ ¼å¼ï¼ˆ.xlsx, .xlsï¼‰</li>
                <li>å¿…éœ€å­—æ®µï¼šTitle_CNï¼ˆä¸­æ–‡åç§°ï¼‰ã€Source_IDï¼ˆæ¥æºæœºæ„IDï¼‰ã€Original_IDï¼ˆåŸå§‹ç¼–å·ï¼‰</li>
                <li>å¯é€‰å­—æ®µï¼šTitle_ENã€Description_CNã€Classificationã€Materialã€Date_CNã€Date_EN ç­‰</li>
                <li>æ‰¹é‡å¯¼å…¥æ—¶ï¼Œç³»ç»Ÿä¼šæ ¹æ® Source_ID + Original_ID åˆ¤æ–­æ˜¯å¦ä¸ºé‡å¤è®°å½•</li>
            </ul>
        </div>
        
        <form action="{{ url_for('admin_import') }}" method="POST" enctype="multipart/form-data" id="importForm">
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">ğŸ“</div>
                <div class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
                <div class="upload-hint">æ”¯æŒ CSVã€XLSXã€XLS æ ¼å¼</div>
            </div>
            
            <input type="file" 
                   id="fileInput" 
                   name="file" 
                   accept=".csv,.xlsx,.xls" 
                   class="file-input"
                   required>
            
            <!-- å·²é€‰æ‹©æ–‡ä»¶æç¤º -->
            <div class="selected-file" id="selectedFile">
                <span class="selected-file-name" id="selectedFileName"></span>
                <button type="button" onclick="clearFile()" style="float: right; background: none; border: none; color: #d32f2f; cursor: pointer; font-weight: bold;">âœ• æ¸…é™¤</button>
            </div>
            
            <!-- å¯¼å…¥é€‰é¡¹ -->
            <div class="import-options">
                <div class="option-group">
                    <label class="option-label">é‡åˆ°é‡å¤è®°å½•æ—¶ï¼š</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="import_mode" value="skip" checked>
                            è·³è¿‡ï¼ˆä¿ç•™åŸè®°å½•ï¼‰
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="import_mode" value="update">
                            æ›´æ–°ï¼ˆè¦†ç›–åŸè®°å½•ï¼‰
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- æäº¤æŒ‰é’® -->
            <button type="submit" class="submit-btn" id="submitBtn" disabled>
                å¼€å§‹å¯¼å…¥
            </button>
        </form>
    </div>
</div>

<script>
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const selectedFile = document.getElementById('selectedFile');
    const selectedFileName = document.getElementById('selectedFileName');
    const submitBtn = document.getElementById('submitBtn');
    
    // æ–‡ä»¶é€‰æ‹©
    fileInput.addEventListener('change', function(e) {
        if (this.files.length > 0) {
            const file = this.files[0];
            selectedFileName.textContent = file.name + ' (' + formatFileSize(file.size) + ')';
            selectedFile.classList.add('show');
            submitBtn.disabled = false;
        }
    });
    
    // æ‹–æ‹½ä¸Šä¼ 
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            fileInput.dispatchEvent(new Event('change'));
        }
    });
    
    // æ¸…é™¤æ–‡ä»¶
    function clearFile() {
        fileInput.value = '';
        selectedFile.classList.remove('show');
        submitBtn.disabled = true;
    }
    
    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
        if (bytes < 1024) return bytes + ' B';
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
    }
    
    // è¡¨å•æäº¤æ—¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    document.getElementById('importForm').addEventListener('submit', function() {
        submitBtn.textContent = 'æ­£åœ¨å¯¼å…¥ï¼Œè¯·ç¨å€™...';
        submitBtn.disabled = true;
    });
</script>
{% endblock %}